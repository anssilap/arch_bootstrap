- hosts: localhost
  connection: local
  tasks:
  - name: Pacman update
    community.general.pacman:
      update_cache: yes
      upgrade: yes
    become: yes

  - name: Check if yay is installed
    ansible.builtin.shell: yay --version | wc -l
    register: yay_installed

  - name: Install yay if not installed already
    - block:
        - name: Get yay source code
          git:
            repo: https://aur.archlinux.org/yay-git.git
            dest: ~/yay-git
        - name: Build and install yay
          command: chdir=~/yay-git makepkg -si --noconfirm
        - name: Remove yay git directory
          command: rm -rf ~/yay-git
      tags: yay
      when: yay_installed.stdout != "1"
